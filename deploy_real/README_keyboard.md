# 键盘控制真实机器人

## 概述

这个版本使用键盘控制真实的Unitree G1机器人，避免了手柄映射的问题，让policy切换更加可靠。支持实时键盘控制和基础键盘控制两种模式。

## 文件说明

1. `deploy_real.py` - 手柄控制版本
   - 使用Xbox手柄控制机器人
   - 支持摇杆控制和按键切换
   - 适合有手柄的用户

2. `deploy_real_keyboard.py` - 实时键盘控制版本
   - 使用实时按键检测
   - 无需按回车键，直接响应按键
   - 支持实时摇杆控制
   - 提供实时状态显示

3. `config.py` - 配置文件加载器
   - 加载 `config/real.yaml` 配置文件
   - 管理网络、关节数、话题等参数

4. `config/real.yaml` - 真实机器人配置文件
   - 网络配置
   - 关节数量设置
   - DDS话题配置
   - 控制参数

## 使用方法

### 手柄控制版本
```bash
python deploy_real/deploy_real.py
```

### 实时键盘控制版本
```bash
python deploy_real/deploy_real_keyboard.py
```

## 控制说明

### 模式切换
- `1` - 阻尼保护模式 (PASSIVE)
- `2` - 位控模式 (POS_RESET)
- `3` - 行走模式 (LOCO)
- `4` - 舞蹈模式 (SKILL_1)
- `5` - 武术模式 (SKILL_2)
- `6` - 踢腿模式 (SKILL_3)
- `7` - 武术2模式 (SKILL_4)

### 摇杆控制 (键盘版本)
- `w` - 前进加速 (+0.2)
- `s` - 后退加速 (-0.2)
- `a` - 左移加速 (+0.2)
- `d` - 右移加速 (-0.2)
- `j` - 左转加速 (+0.2)
- `l` - 右转加速 (-0.2)
- `空格键` - 重置摇杆
- `z` - 停止走路

### 手柄控制 (手柄版本)
- `Start` - 位控模式
- `F1` - 阻尼保护模式
- `R1 + A` - 行走模式
- `R1 + X` - 舞蹈模式
- `R1 + Y` - 武术模式
- `Select` - 退出程序

### 其他控制
- `q` - 退出程序 (键盘版本)
- `Ctrl+C` - 强制退出

## 安全注意事项

### 机器人安全
1. **确保机器人处于安全状态**
   - 机器人必须处于悬挂状态或安全环境中
   - 确保周围没有障碍物
   - 准备紧急停止按钮

2. **启动前检查**
   - 检查电源连接
   - 检查网络连接
   - 确保DDS通信正常

3. **操作安全**
   - 始终从阻尼保护模式开始
   - 避免突然的模式切换
   - 保持安全距离

### 网络配置
确保 `config/real.yaml` 中的网络配置正确：
```yaml
net: "lo"  # 本地回环网络
# 或使用实际网络接口
```

## 故障排除

### 如果policy切换不成功

1. **检查PassiveMode的checkChange方法**
   - 确保PassiveMode能正确处理所有命令
   - 这是初始状态，必须能响应所有切换命令

2. **检查FSM状态切换逻辑**
   - 确保FSM的run()方法正确调用checkChange()
   - 确保get_next_policy()方法正确映射状态

3. **检查命令传递**
   - 确保state_cmd.skill_cmd正确设置
   - 确保命令在FSM运行前设置

### 常见问题

1. **DDS连接失败**
   - 检查网络配置
   - 确保机器人SDK正确安装
   - 检查防火墙设置

2. **按键无响应**
   - 检查终端是否处于输入状态
   - 确保没有其他程序占用键盘输入
   - 检查权限设置

3. **机器人不响应**
   - 检查DDS话题配置
   - 确保机器人处于正确模式
   - 检查控制循环时间

4. **控制延迟**
   - 降低控制频率
   - 检查网络延迟
   - 优化控制循环

## 与仿真版本的区别

1. **硬件要求**
   - 仿真版本：只需要Mujoco环境
   - 真实版本：需要Unitree G1机器人和SDK

2. **安全性**
   - 仿真版本：无安全风险
   - 真实版本：需要严格的安全措施

3. **网络配置**
   - 仿真版本：无需网络配置
   - 真实版本：需要DDS网络配置

4. **控制精度**
   - 仿真版本：理想环境
   - 真实版本：受硬件限制

## 扩展功能

可以进一步扩展真实机器人控制功能：

1. **更多安全功能**
   - 添加碰撞检测
   - 实现自动紧急停止
   - 添加安全区域限制

2. **配置文件**
   - 支持自定义按键映射
   - 支持保存用户偏好
   - 支持多机器人配置

3. **监控界面**
   - 添加图形化监控界面
   - 显示实时状态信息
   - 记录操作日志

4. **远程控制**
   - 支持网络远程控制
   - 添加视频流显示
   - 实现多用户控制

## 重要提醒

⚠️ **使用真实机器人时请务必注意安全！**

- 始终确保机器人在安全环境中运行
- 准备紧急停止机制
- 熟悉所有安全操作流程
- 建议先在仿真环境中充分测试 