# 键盘控制机器人仿真

## 概述

这个版本使用键盘控制机器人，避免了手柄映射的问题，让policy切换更加可靠。

## 文件说明

1. `deploy_mujoco_keyboard.py` - 基础键盘控制版本
   - 使用 `input()` 函数获取键盘输入
   - 需要按回车键确认命令
   - 适合调试和测试

2. `deploy_mujoco_keyboard_realtime.py` - 实时键盘控制版本
   - 使用实时按键检测
   - 无需按回车键，直接响应按键
   - 支持实时摇杆控制

## 使用方法

### 基础版本
```bash
python deploy_mujoco/deploy_mujoco_keyboard.py
```

### 实时版本
```bash
python deploy_mujoco/deploy_mujoco_keyboard_realtime.py
```

## 控制说明

### 模式切换
- `1` - 阻尼保护模式 (PASSIVE)
- `2` - 位控模式 (POS_RESET)
- `3` - 行走模式 (LOCO)
- `4` - 舞蹈模式 (SKILL_1)
- `5` - 武术模式 (SKILL_2)
- `6` - 踢腿模式 (SKILL_3)
- `7` - 武术2模式 (SKILL_4)

### 摇杆控制 (仅实时版本)
- `w` - 前进
- `s` - 后退
- `a` - 左移
- `d` - 右移
- `空格键` - 重置摇杆

### 其他控制
- `q` - 退出程序

## 故障排除

### 如果policy切换不成功

1. **检查PassiveMode的checkChange方法**
   - 确保PassiveMode能正确处理所有命令
   - 这是初始状态，必须能响应所有切换命令

2. **检查FSM状态切换逻辑**
   - 确保FSM的run()方法正确调用checkChange()
   - 确保get_next_policy()方法正确映射状态

3. **检查命令传递**
   - 确保state_cmd.skill_cmd正确设置
   - 确保命令在FSM运行前设置

### 常见问题

1. **按键无响应**
   - 检查终端是否处于输入状态
   - 确保没有其他程序占用键盘输入

2. **模式切换失败**
   - 检查当前模式的checkChange()方法
   - 确保目标模式在FSM中正确初始化

3. **仿真卡顿**
   - 降低显示更新频率
   - 检查控制循环时间

## 与原手柄版本的区别

1. **输入方式**
   - 手柄版本：使用pygame检测手柄按键
   - 键盘版本：使用标准输入或实时按键检测

2. **可靠性**
   - 手柄版本：依赖手柄映射，可能有兼容性问题
   - 键盘版本：标准输入，兼容性更好

3. **功能**
   - 手柄版本：支持模拟摇杆
   - 键盘版本：支持数字摇杆控制

## 扩展功能

可以进一步扩展键盘控制功能：

1. **更多按键映射**
   - 添加更多模式切换快捷键
   - 支持组合键

2. **配置文件**
   - 支持自定义按键映射
   - 支持保存用户偏好

3. **GUI界面**
   - 添加图形化控制界面
   - 显示实时状态信息 